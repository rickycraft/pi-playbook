---
- name: Install packages
  apt:
    name:
      - "tmux"
      - "curl"
      - "sysstat"
      - "htop"
      - "git"
      - "unzip"
      - "zip"
      - "tar"
    state: present
- name: Allow root login
  lineinfile:
    path: "/etc/ssh/sshd_config"
    regexp: "^#PermitRootLogin without-password"
    line: "PermitRootLogin without-password"
  notify: "Restart ssh"
- name: Disable ssh dns
  lineinfile:
    path: "/etc/ssh/sshd_config"
    regexp: "^#UseDNS no"
    line: "UseDNS no"
- name: Copy ssh dir
  copy:
    src: files/.ssh/
    dest: /root/.ssh
    mode: '600'
- name: Copy priv key
  copy:
    src: files/id_rsa
    dest: /root/.ssh/id_rsa
    mode: '400'
- name: Copy ssh fingerprint
  copy:
    src: files/ssh_host/
    dest: /etc/ssh
  notify: "Restart ssh"
- name: Clone git script
  git:
    repo: "git@github.com:rickycraft/script.git"
    dest: /root/script
- name: Add cron path
  cron:
    name: PATH
    env: true
    job: "/bin:/usr/bin:/sbin:/root/script/hassio:/root/script/bash"
- name: Cron
  cron:
    name: "Cron {{ outer_item.file }}"
    job: "{{ outer_item.file }}"
    minute: "0"
    hour: "{{ outer_item.hour }}"
    weekday: "{{ outer_item.weekday }}"
  notify: "Restart cron"
  loop:
    - { file: "ha-backup", hour: "3", weekday: "*"}
    - { file: "nginx-backup", hour: "4", weekday: "1"}
    - { file: "bot-backup", hour: "4", weekday: "*"}
  loop_control:
    loop_var: outer_item
